!function(){var t={};t.VERSION=1,t.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},t.id=0|998*Math.random(),t.getNewID=function(){return t.id++},t.createEvent=function(e,n){var i=new t.Event(e);return i.target=n,i},t.getRangeRandom=function(t,e){return Math.floor(t+Math.random()*(e-t))},t.isFunction=function(t){return"function"==typeof t},t.isString=function(t){return"string"==typeof t},t.getRandomPosition=function(t){var e={},n=t.width-83-170,i=t.height-192-35;return e.x=n*Math.random()+35,e.y=i*Math.random()+90,e},window.cm=t}(),window.cm=window.cm||{},function(){"use strict";function t(t,e,n){this.type=t,this.target=null,this.realTarget=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!e,this.cancelable=!!n,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var e=t.prototype;e.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},e.stopPropagation=function(){this.propagationStopped=!0},e.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},e.remove=function(){this.removed=!0},e.clone=function(){return new t(this.type,this.bubbles,this.cancelable)},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.toString=function(){return"[Event (type="+this.type+")]"},window.cm.Event=t}(),window.cm=window.cm||{},function(){"use strict";function t(){this._listeners=null,this._captureListeners=null}var e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.on=e.on,t.removeEventListener=t.off=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent,t._dispatchEvent=e._dispatchEvent,t.willTrigger=e.willTrigger},e.addEventListener=function(t,e,n){var i;i=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var o=i[t];return o&&this.removeEventListener(t,e,n),o=i[t],o?o.push(e):i[t]=[e],e},e.on=function(t,e,n,i,o,s){return e.handleEvent&&(n=n||e,e=e.handleEvent),n=n||this,this.addEventListener(t,function(t){e.call(n,t,o),i&&t.remove()},s)},e.removeEventListener=function(t,e,n){var i=n?this._captureListeners:this._listeners;if(i){var o=i[t];if(o)for(var s=0,a=o.length;a>s;s++)if(o[s]==e){1==a?delete i[t]:o.splice(s,1);break}}},e.off=e.removeEventListener,e.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},e.dispatchEvent=function(t){if("string"==typeof t){var e=this._listeners;if(!e||!e[t])return!1;t=new window.cm.Event(t)}else t.realTarget&&t.clone&&(t=t.clone());try{t.realTarget=this}catch(n){}if(t.bubbles&&this.parent){for(var i=this,o=[i];i.parent;)o.push(i=i.parent);var s,a=o.length;for(s=a-1;s>=0&&!t.propagationStopped;s--)o[s]._dispatchEvent(t,1+(0==s));for(s=1;a>s&&!t.propagationStopped;s++)o[s]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return t.defaultPrevented},e.hasEventListener=function(t){var e=this._listeners,n=this._captureListeners;return!!(e&&e[t]||n&&n[t])},e.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},e.toString=function(){return"[EventDispatcher]"},e._dispatchEvent=function(t,e){var n,i=1==e?this._captureListeners:this._listeners;if(t&&i){var o=i[t.type];if(!o||!(n=o.length))return;try{t.currentTarget=this}catch(s){}try{t.eventPhase=e}catch(s){}t.removed=!1,o=o.slice();for(var a=0;n>a&&!t.immediatePropagationStopped;a++){var m=o[a];m.handleEvent?m.handleEvent(t):m(t),t.removed&&(this.off(t.type,m,1==e),t.removed=!1)}}},window.cm.EventDispatcher=t}(),function(t){var e=function(){t.EventDispatcher.call(this)};t.inherit(e,t.EventDispatcher),t.BaseView=e}(cm),function(t){t.objectPoolFactory=function(t){return{objectPool:[],create:function(){var e=this.objectPool,n=0===e.length?t.apply(this,arguments):e.shift();return n},recover:function(t){this.objectPool.push(t)}}}}(cm),function(t){t.barrageFadeAnimation=function(t,e){var n=this._showMessagePool;if(e)for(var i=n.length-1;i>=0;i--){var o=n[i].$dom;o.off("webkitAnimationEnd animationEnd"),o.removeClass("comment-msg-fade")}else if(n.length>=this._showCount){var s=n[0];s.$dom.removeClass("comment-msg-show"),s.$dom.on("webkitAnimationEnd animationEnd",function(){s.$dom.off("webkitAnimationEnd animationEnd"),s.dispatchEvent("message:animation:end")}),s.$dom.addClass("comment-msg-fade")}},t.barrageMoveAnimation=function(t,e){this._showMessagePool;this.$dom.off("webkitAnimationEnd animationEnd")}}(cm),cm.Const={defaultUserPic:"http://ac-hf3jpeco.clouddn.com/8c665e1f11f2fbe1c59d"},function(){var t=[];if(t.push("@-webkit-keyframes comment-msg-fade-frame {0%{opacity:1}88%{opacity:1}100%{opacity:0}}"),t.push("@keyframes comment-msg-fade-frame {0%{opacity:1}88%{opacity:1}100%{opacity:0}}"),t.push("@-webkit-keyframes comment-msg-show-frame {0%{opacity:0}100%{opacity:1}}"),t.push("@keyframes comment-msg-show-frame {0%{opacity:0}100%{opacity:1}}"),t.push(".comment-msg-fade{-webkit-animation-name: comment-msg-fade-frame;animation-name: comment-msg-fade-frame; -webkit-animation-duration: 2s;animation-duration: 2s;-webkit-animation-fill-mode: both;animation-fill-mode: both;}"),t.push(".comment-msg-show{-webkit-animation-name: comment-msg-move-frame;animation-name: comment-msg-move-frame; -webkit-animation-duration:5s;animation-duration: 5s;animation-iteration-count:1;-webkit-animation-iteration-count:1;animation-timing-function:cubic-bezier(.55,.77,.49,.01);-webkit-animation-timing-function:cubic-bezier(.55,.77,.49,.01);-webkit-animation-fill-mode: both;animation-fill-mode: both;}"),t.push("@-webkit-keyframes comment-msg-move-frame{0%{-webkit-transform: translate3d(200%, 0, 0); }100%{-webkit-transform: translate3d(-200%, 0, 0);}}"),t.push(".animation-paused{animation-play-state:paused;-webkit-animation-play-state:paused;}"),t.push(".animation-run{animation-play-state:running;-webkit-animation-play-state:running;}"),!document.getElementById("style-comment-animation")){var e=document.createElement("style");e.type="text/css",e.id="style-comment-animation",e.innerHTML=t.join(""),document.head.appendChild(e)}}(),function(){var t=[];if(t.push(".comment-message{position: absolute;width: 60%;height: auto;white-space: nowrap;font-size: 0;color: #fff;}"),t.push(".comment-message-photo{width: 70px;height: 70px;border: 2px solid rgba(0,0,0,.2);border-radius: 50%; overflow:hidden;}"),t.push(".comment-message-photo img{width: 100%;height: 100%;}"),t.push(".comment-message-content{max-width: -webkit-calc(100% - 80px);max-width: calc(100% - 80px);text-align: justify;white-space: pre-line;padding: 15px 20px;min-height: 70px;font-size: 26px;white-space:normal;word-wrap:break-word;border-radius: 40px;background-color: rgba(0,0,0,0.5);box-sizing: border-box;}"),t.push(".comment-message-left .comment-message-photo{float:left; margin-right:8px;}"),t.push(".comment-message-left .comment-message-content{float:left; }"),t.push(".comment-message-right .comment-message-photo{float:right; margin-left:8px;}"),t.push(".comment-message-right .comment-message-content{float:right; }"),t.push(".comment-reply-container{position:fixed;width:100%;height:90px;left:0;bottom:0;background:#f2f2f2;z-index:100005;}"),t.push(".comment-reply-txt{position:relative;display:table;width:100%;height:100%;text-align:center;font-size:18px;}"),t.push(".comment-reply-container .comment-reply-txt .comment-table-cell:nth-child(1){width:15%;display:none}"),t.push(".comment-reply-container .comment-reply-txt .comment-table-cell:nth-child(2){padding-left:15px;}"),t.push(".comment-reply-container .comment-reply-txt .comment-table-cell:nth-child(3){color:#666;}"),t.push(".comment-reply-container .comment-reply-txt .comment-table-cell{vertical-align:middle;}"),t.push(".comment-table-cell{height:100%;font-size:26px;color:#FFF;display:table-cell;}"),t.push(".comment-reply-container .comment-reply-txt .comment-reply-input{display:inline-block;width:100%;height:60px;padding:10px 10px;word-break:break-all;word-wrap:break-word;border:1px solid #ccc;text-align:left;border-radius:10px;color:#000;font-size:24px;box-sizing:border-box;}"),t.push(".comment-reply-container .comment-reply-txt .comment-sent-btn{display: inline-block;height: 100%;width: 50px;background-color: transparent;}"),t.push(".comment-reply-container .comment-reply-txt .cno-send-btn{background:url('data:image/png;base64,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') center center no-repeat;}"),t.push(".comment-reply-container .comment-reply-txt .cyes-send-btn{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABRFBMVEUAAAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAD/zAH/1Cr/zgn/zQb/7qr/////99X/zQT/zQX/7qz///7/0BX/7qv/5oT/zQP/6Iz/7qn/6I7/7af/6Y//6ZD/1zX/20n/7aX/1zn/65r/7aP/6ZL/203/7KH/6pT/7J//6pb/zAL/7J7/6pj/653/65v/+Nr/65z/6pf//voAAABbdXPBAAAAQHRSTlMAFlePt9jt+BNxy/4ZjfT1kxoEdfMFJc7PKk/xUGb8aU4p0HaUlRT2cMxYW7bb8vnsXBdyJlEGensbjhy42e76B63O0wAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAHZSURBVEjHnZYHU8IwFMefFFGoCwFxMBQFBBUVtyI8HHFb9564/f4fwABHm7ZpWvzf5S4v+f3vsl8AjGpxSe5WT1ubp9UtuVrARu1en4yMZJ+3XYB3dHahSd09fgu8NxBEroKBEI/vC6Ol+gfM/OAQChSMGPloDIWKRfV8HG0VZ/nhmL0hNqzxI0F7ns5jpMGHEk54xERjdQPOeMTROu93NKDaoOp7PuaUR0xW+VRaDJU3NtV6OkUN42J+a5vs7KrRODVkhPzePiEHh2roo/dFFvG7R4SQYy2W/ZAV8co25U/YlgmQRPwp5c90TRK4Bfw55S/0bZMwJeYvy/rGKchpwdU126vccHjMgVa/PSB3Wr9yT/kHI4/IGB4poTqUJxo9m/lpZkjlF82hVOuvZh5n2EkrqqPyRmvvHJ5Oml3WhqP8wY7OsKy6jas7KlX+k8vTjdMfjZrji5ZvPo+zkJfNDkI+LHh6+IzHu+Z4q/B5zHAukPLze6dY8Djn4Iqyql1RSDo3JP/3zDT9kEEo7IwPq4mob8gJn5v//3PffEJpPmUBRMRJcaG5tJvgpF2AxSWLQ5JeXrT4C6ys8r4OY2tgrZQ3o/+cZLwpsFE+KxXWi6VScb0gZfOm7j9/FMZAyfJwSgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0wOC0yMVQxNTozOToyMyswODowMBGrnn0AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTUtMDgtMjFUMTU6Mzk6MjMrMDg6MDBg9ibBAAAAAElFTkSuQmCC') center center no-repeat;}"),t.push(".comment-mask-parent{position:absolute;left:0;top:0;width:100%;height:100%;z-index:100002;background:rgba(0,0,0,0.5);overflow:hidden;}"),t.push(".comment-ocbalert{width:100%;height:88px;background:#000;position:absolute;left:0;bottom:0;}"),t.push(".ocbalert-ok,.ocbalert-cancel{font-size:28px;color:#ffffff;width:50%;height:100%;display:inline-block;text-align:center;line-height:88px;}"),t.push(".comment-barrage-container{position:absolute;pointer-events: none;width:100%;height:100%;overflow:hidden;}"),!document.getElementById("style-comment")){var e=document.createElement("style");e.type="text/css",e.id="style-comment",e.innerHTML=t.join(""),document.head.appendChild(e)}t.length=0,t=null}(),function(t){var e={};e.getCommentList=function(t,e,n){var i=t.commentType||0,o=t.tplPageId,s=t.orderBy||"createdAt",a=void 0===t.isDesc?!0:t.isDesc,m=t.pageSize,r=t.pageNumber,c=0,h=r;if(0!=m&&(c=m*r),!o)return void n();var d=" select include comment_uid_pointer.user_nick,comment_uid_pointer.user_pic,comment_content,comment_uid from me_comment where  comment_state=0 and comment_display=0 ";0==i?d+=" and  belong_tpl='"+o+"'":1==i?d+=" and  belong_tplpage='"+o+"'":2==i&&(d+=" and  belong_comment='"+o+"'"),d+=a?" order by "+s+" desc ":" order by "+s+" asc ",c>=0&&h>0&&(d+=" limit "+c+","+h),fmacloud.Query.doCloudQuery(d,{success:function(t){e(t)},error:function(t){n(t)}})},e.replyComment=function(t,e,n){var i=this.getCurrentUser();if(i){t.comment_uid=i.id,t.data_site=t.data_site||0;var o=this;sns_data.snsSaveComment(t,function(n){o._opCommentCount(t.comment_id,1),e&&e(n)},function(t){n&&n(t),console.log("评论失败,错误信息",t)})}};var n={};e.getPraiseCount=function(t,e){return n[t]?void e(n[t]):void sns_data.getSnsLikeCount(t,function(i){n[t]=i,e(i)},function(t){e(0)})},e._opPraiseCount=function(t,e){n[t]&&(n[t]=n[t]+e)};var i={};e.getCommentCount=function(t,e,n){return i[e]?void n(i[e]):void sns_data.getSnsCommentCountByCid(t,e,function(t){i[e]=t,n(t)},function(){n(0)})},e._opCommentCount=function(t,e){i[t]&&(i[t]=i[t]+e)};var o={};e.getCurrentUserPraises=function(t,e){var n=this.getCurrentUser(),i=n.id+"-"+t;return o[i]?void e(o[i]):void sns_data.getSnsLike(n.id,t,"","","","",function(t){o[i]=t,e(t)},function(){e([])})},e.getPraiseStatus=function(t,e){this.getCurrentUserPraises(t,function(n){for(var i=!1,o=0;o<n.length;o++){var s=n[o];if(s.get("like_tplid")==t){i=!0;break}}e(i)})},e._deletePraiseStatus=function(t){var e=this.getCurrentUser(),n=e.id+"-"+t;if(o[n])for(var i=o[n],s=i.length-1;s>=0;s--){var a=i[s];a.get("like_tplid")==t&&i.splice(s,1)}},e._addPraiseStatus=function(t,e){var n=this.getCurrentUser(),i=n.id+"-"+t;o[i]&&o[i].push(e)},e.praise=function(t,e,n){var i="cancerlike",o=this;this.getPraiseStatus(t.id,function(s){i=s?"cancerlike":"like";var a={like_opration:i,like_type:t.tplType,like_tplid:t.id,belong_tpl:t.tplId,belong_tplpage:t.pageid,belong_comment:t.commentUid,data_site:t.dataSite};sns_data.snsSaveLike(a,function(n){"cancerlike"==i?(o._deletePraiseStatus(t.id),o._opPraiseCount(t.id,-1)):(o._addPraiseStatus(t.id,n),o._opPraiseCount(t.id,1)),e(i,n)},function(){n&&n()})})},e.msgPush=function(t,e,n){sns_data.msgAdd(t,function(t){e(t)},function(){n&&n()})},e.getCurrentUser=function(){return sns_data.getCurrentUser()},t.commentModel=e}(cm),function(t){var e=t.objectPoolFactory(function(){var n=new t.Comment;return n.onDestroy=function(){e.recover(n)},n});t.commentFactory=e}(cm),function(t){var e=t.objectPoolFactory(function(){var n=new t.MessageView;return n.onHide=function(){e.recover(n)},n});t.messageFactory=e}(cm),function(t){function e(){return 1e3}var n=function(e){t.EventDispatcher.call(this),this.comment=e,this._showCount=5;var n=this.dom=this.comment.barrageContainer;this.$dom=$(this.dom),this._isShow=!1,this._currentIndex=0,this._commentIndex=0,this._tempCommentIndex=0,this._commentDataList=[],this._isDataLoading=!1,this._showMessagePool=[],this._loadOver=!1,this._timer=null,this._paused=!1,this.$dom.css({zIndex:1e5,width:n.style.width,height:n.style.height})};t.inherit(n,t.EventDispatcher);var i=n.prototype;i.show=function(){this._isShow||(this.start(),this._addEvent(),this._isShow=!0,this.$dom.show(),this.createMessage())},i._getCommentData=function(e){var n=this._commentDataList,i=this.commentIndex,o=e,s=this._commentDataList,a=this;if(this._loadOver)this._commentDataList.length>=1&&(this._tempCommentIndex>this._commentDataList.length-1&&(this._tempCommentIndex=0),e(this._commentDataList[this._tempCommentIndex]),this._tempCommentIndex++);else if(n.length-1-i<5){if(i<=n.length-1&&(o(n[i]),this.commentIndex++,o=null),!this._isDataLoading){this._isDataLoading=!0;var m=this._currentIndex;t.commentModel.getCommentList({pageNumber:m,pageSize:1e3,tplPageId:this.comment.tplId},function(t){t.results.length>0?(a._commentDataList=n.concat(t.results),o&&a._commentDataList&&a._commentDataList.length>0&&(o(a._commentDataList[i]),a.commentIndex++)):a._loadOver=!0,a._loadOver=!0,a._isDataLoading=!1,o=null},function(){a._isDataLoading=!1})}}else o(s[i]),this.commentIndex++},Object.defineProperty(i,"commentIndex",{get:function(){return this._commentIndex},set:function(t){this._commentIndex=t,this._tempCommentIndex=t}}),i.hide=function(){this._isShow&&(this._isShow=!1,this._removeEvent(),this.$dom.hide())},i._addEvent=function(){var t=this;this.$dom.on("tap",function(e){e.preventDefault(),e.stopPropagation(),t._checkClickMsg(e)})},i._checkClickMsg=function(e){var n=this.comment;if(!n.lockBarrageEvent){for(var i,o=e.target,s=this._showMessagePool,a=s.length-1;a>=0&&(i=s[a],i.dom!==o&&!i.$dom.find(o)[0]);a--)i=null;var m=t.createEvent("barrage:click",o),r=null;i?(r=i.getMessageData(),m.target=i.dom,n.selectedTarget=i.dom):n.selectedTarget=o,m.data=r,n.selectedData=r,n.dispatchEvent(m)}},i._removeEvent=function(){this.$dom.off("tap")},i.createMessage=function(){if(!this._paused){var t=this,n=this._showCount;this._showMessagePool.length<n&&this._getCommentData(function(n){if(t._commentDataList.length>t._showMessagePool.length){var i=t._createMessageByData(n);i.show(),setTimeout(function(){t.createMessage()},e())}})}},i.createTempMessage=function(e){var n=t.messageFactory.create();n.init2(e.content,this),n.tempShow();var i=e.replyTarget;n.selected=!0;var o=this,s=this.comment;t.OCBAlert.show(function(){var a=s.replyView,m="",r=a.commentDraft;m=i?i.objectId:s.pageTplId,r[m]="";var c=t.createEvent("comment:open:handle");s.dispatchEvent(c),o._sendMsgToServer(n,e.content,i),s.lockBarrageEvent=!1,n.$dom.remove()},function(){if(!s.isShowBarrage){var e=t.createEvent("comment:close:handle");s.dispatchEvent(e)}n.hide(),s.lockBarrageEvent=!1;var e=t.createEvent("reply:error");s.dispatchEvent(e)})},i._sendMsgToServer=function(e,n,i){var o,s={},a=this._createContent(e,n,i),m=this.comment;i?(s.comment_id=i.objectId,s.belong_comment=i.objectId,o=i.comment_uid):(s.comment_id=m.tplId,s.belong_comment="",o=m.tplUserId),s.comment_type=i?2:m.tplType,s.comment_content=JSON.stringify(a),s.data_site=m.dateSite,s.belong_tpl=m.tplId,s.belong_tplpage=m.pageTplId;var r=t.commentModel.getCurrentUser(),c=this;t.commentModel.replyComment(s,function(i){var h=c._createData(i.objectId,JSON.stringify(a));if(e.hide(),e=c._createMessageByData(h),e.show(!0),setTimeout(function(){c._commentDataList.push(h)},2e3),o&&o!=r.id){var d=m.tplShareImage;d=d.replace(/^(AV:)/g,"");var l=m.tplUserId,p={tpl_id:m.tplId,pageid:m.pageTplId,tpl_user:m.tplUserId,effecturl:d},u={content:n},g={msg_recid:l,msg_type:2,tpl_name:m.tpl_name,msg_obj:JSON.stringify(p),mt_content:JSON.stringify(u)};sns_data.msgAdd(g,function(t){if(m._selectedData){var e=m._selectedData.comment_uid_pointer.user_nick,i=JSON.parse(s.comment_content);i=i.content;var o={content:n,old_content:i,uname:e,old_userId:m._selectedData.comment_uid};g.mt_content=JSON.stringify(o),sns_data.msgAdd(g,function(t){},function(t){})}},function(t){console.log(t)})}var f=t.createEvent("reply:success");m.dispatchEvent(f)},function(){var e=t.createEvent("reply:network:error");m.dispatchEvent(e)})},i._createData=function(e,n){var i=t.commentModel.getCurrentUser(),o={};return o.comment_content=n,o.comment_uid_pointer={user_nick:i.get("user_nick"),user_pic:i.get("user_pic")||t.Const.defaultUserPic},o.objectId=e,o.comment_uid=i.id,o},i._createContent=function(t,e,n){var i={},o=this.comment.tplShareImage;if(o=o.replace(/^(AV:)/g,""),n){var s=JSON.parse(n.comment_content);i.uid=n.comment_uid,i.uname=n.comment_uid_pointer.user_nick,i.old_content=s.content}i.content=e,i.tpl_effect=o;var a=this.dom,m=a.clientWidth,r=t.$dom.css("left"),c=t.$dom.css("top"),h=!1;return parseInt(r)>m/2&&(h=!0),i.imgPos=h,i.x=r,i.y=c,i},i._createMessageByData=function(e){var n,i=t.messageFactory.create();return e.toJSON?(n=e.toJSON(),e.get("comment_uid_pointer")&&(n.comment_uid_pointer.user_nick=e.get("comment_uid_pointer").get("user_nick"),n.comment_uid_pointer.user_pic=e.get("comment_uid_pointer").get("user_pic"))):n=e,i.init(n,this),i},i.removeMessage=function(t){t.dom.parentNode&&t.dom.parentNode.removeChild(t.dom),this._removeMsgFormPool(t);var n=this;this._isShow&&setTimeout(function(){n.createMessage()},e())},i.showTempMessage=function(t){this.dom.appendChild(t.dom)},i._removeMsgFormPool=function(t){var e;(e=this._showMessagePool.indexOf(t))>=0&&this._showMessagePool.splice(e,1)},i.addMessage=function(t){t.dom.parentNode!=this.dom&&(t.dom.parentNode&&t.dom.parentNode.removeChild(this.dom),this.dom.appendChild(t.dom)),this._showMessagePool.push(t),this._paused||t.play()},i.paused=function(){if(!this._paused){this._paused=!0;for(var t=0;t<this._showMessagePool.length;t++)this._showMessagePool[t].stop&&this._showMessagePool[t].stop()}},i.start=function(){if(this._paused){this._paused=!1,this.createMessage();for(var t=0;t<this._showMessagePool.length;t++)this._showMessagePool[t].start&&this._showMessagePool[t].start()}},i.clear=function(){this.commentIndex=0,this._currentIndex=0,this._commentDataList=[],this._isDataLoading=!1,this.hide();for(var t;this._showMessagePool.length>0;)t=this._showMessagePool.shift(),t.hide(),t.clear();this._showMessagePool=[],this._loadOver=!1,this._timer&&(window.clearTimeout(this._timer),this._timer=null),this._paused=!0,this.comment.barrageContainer.innerHTML=""},t.BarrageView=n}(cm),function(t){var e=function(){t.EventDispatcher.call(this),this.barrageContainer=document.createElement("div"),this.barrageContainer.className="comment-barrage-container",this._lockBarrageEvent=!1,this.barrageView=null,this.replyView=null,this.isShowBarrage=!0,this._selectedTarget=null,this._selectedData=null,this._lockPraise=!1};t.inherit(e,t.EventDispatcher);var n=e.prototype;n.init=function(t){t=t||{},this.tplId=t.tplId,this.tpl_name=t.tplName,this.pageTplId=t.pageTplId,this.tplUserId=t.tplUserId,this.tplShareImage=t.tplShareImage,this.tplType=t.tplType||0,this.dataSite=t.dataSite||0},Object.defineProperty(n,"lockBarrageEvent",{get:function(){return this._lockBarrageEvent},set:function(t){this._lockBarrageEvent=t}}),n._initEvent=function(){},n.openBarrage=function(){this.barrageView||(this.barrageView=new t.BarrageView(this)),this.isShowBarrage=!0,this.barrageView.show()},n.closeBarrage=function(){this.barrageView&&(this.isShowBarrage=!1,this.barrageView.hide())},n._createReplyFn=function(t){var e={replyTarget:t.replyTarget,content:t.replyText};this.lockBarrageEvent=!0;var n=this.isShowBarrage;this.openBarrage(),this.isShowBarrage=n,this.barrageView.createTempMessage(e)},n.showReply=function(e){this.replyView||(this.replyView=new t.ReplyView(this)),this.replyView.removeAllEventListeners("create:reply"),this.replyView.on("create:reply",this._createReplyFn,this),this.replyView.show(e),this.replyView.$inputText.focus()},n.hideReply=function(){this.replyView&&(this.replyView.removeAllEventListeners("create:reply"),this.replyView.hide())},n.recover=function(){this.lockBarrageEvent=!1,this.selectedObject=null,this.selectedTarget=null,this.hideReply(),this._selectedData=null,this.closeBarrage(),t.OCBAlert.hide(),this.barrageView&&this.barrageView.clear(),this.barrageContainer&&this.barrageContainer.parentNode&&this.barrageContainer.parentNode.removeChild(this.barrageContainer),this.removeAllEventListeners("barrage:click"),this.removeAllEventListeners("reply:success"),this.removeAllEventListeners("reply:error"),this.onDestroy()},Object.defineProperty(n,"selectedTarget",{get:function(){return this._selectedTarget},set:function(t){this._selectedTarget=t}}),Object.defineProperty(n,"selectedData",{get:function(){return this._selectedData},set:function(t){this._selectedData=t}}),n.appendTo=function(t){this.barrageContainer&&(this.barrageContainer.parentNode&&this.barrageContainer.parentNode.removeChild(this.barrageContainer),t.appendChild(this.barrageContainer))},n.remove=function(){this.barrageContainer&&this.barrageContainer.parentNode&&this.barrageContainer.parentNode.removeChild(this.barrageContainer)},n.getPraiseCount=function(e){var n=this._getCommentId(),i=this._getIdParam(n,e);t.commentModel.getPraiseCount(i.id,function(t){i.cb&&i.cb(t)})},n.getCommentCount=function(e){var n=this._getCommentId(),i=t.isString(n)?"comment_id":"belong_tplpage",o=this._getIdParam(n,e);t.commentModel.getCommentCount(i,o.id,function(t){o.cb&&o.cb(t)})},n._getCommentId=function(){return this.selectedData?this.selectedData.objectId:null},n.getPraiseStatus=function(e){var n=this._getCommentId(),i=this._getIdParam(n,e);t.commentModel.getPraiseStatus(i.id,function(t){i.cb&&i.cb(t)})},n.praise=function(e){if(!this._lockPraise){this._lockPraise=!0;var n=this._getCommentId(),i=n?2:1,o=this._getIdParam(n,e),s={};s.id=o.id,s.tplType=i,s.dataSite=this.dataSite,s.pageid=this.pageTplId,s.commentId=n||"";var a="";this.selectedData&&(a=this.selectedData.comment_uid),s.commentUid=a,s.tplId=this.tplId;var m=this;t.commentModel.praise(s,function(e){if("like"==e){var n={tpl_id:s.tplId,pageid:m.pageTplId,tpl_user:m.tplUserId,effecturl:m.tplShareImage},i={msg_recid:m.tplUserId,msg_type:1,tpl_name:m.tpl_name,msg_obj:JSON.stringify(n),mt_content:""};t.commentModel.msgPush(i,function(e){a&&(i.msg_recid=a,i.old_userId=a,t.commentModel.msgPush(i,function(t){},function(t){console.log(t)}))},function(){})}m._lockPraise=!1,o.cb("like"==e)},function(){m._lockPraise=!1})}},n._getIdParam=function(e,n){var i;return t.isString(e)?i=e:t.isFunction(e)?(n=e,i=this.pageTplId):i=this.pageTplId,{id:i,cb:n}},n.onDestroy=function(){},e.create=function(e){var n=t.commentFactory.create();return n.init(e),n},t.Comment=e}(cm),function(t){var e="<div class='comment-message-photo'></div><div class='comment-message-content'></div>",n=window.MouseEvent,i=window.TouchEvent,o=function(){t.BaseView.call(this),this._messageData=null,this._barrageView=null,this.id=t.getNewID(),this.animating=!1,this.$dom=$("<div>"),this.dom=this.$dom[0],this.$dom.addClass("comment-message"),this._selected=!1,this._isShow=!1,this.offset={x:0,y:0},this.dom.innerHTML=e,this.$content=this.$dom.find(".comment-message-content"),this.$photoContainer=this.$dom.find(".comment-message-photo")};t.inherit(o,t.BaseView);var s=o.prototype;s.init=function(t,e){this.selected=!1,this._messageData=t,this._barrageView=e,this.on("message:animation:end",this._animationEnd,this),this._reset()},s.getMessageData=function(){return this._messageData},s.init2=function(e,n){this.$content.html(e),this._barrageView=n;var i=t.commentModel.getCurrentUser(),o=i.get("user_pic")||t.Const.defaultUserPic;this.$photoContainer.html('<img src="'+o+'" >');var s=this._getStageSize(),a=t.getRandomPosition(s);this.$dom.css({left:a.x,top:a.y,"pointer-events":"auto"}),this._resetPos()},s._getStageSize=function(){var t=this._barrageView.dom,e=t.clientWidth,n=t.clientHeight;return{width:e,height:n}},s.play=function(){var t=this;this.$dom.off("webkitAnimationEnd animationEnd").on("webkitAnimationEnd animationEnd",function(){t.$dom.off("webkitAnimationEnd animationEnd"),t.dispatchEvent("message:animation:end")})},s.stop=function(){this.$dom.off("webkitAnimationEnd animationEnd")},Object.defineProperty(s,"isDragging",{get:function(){return!!this._isDragging},set:function(t){this._isDragging=t,t?this._addEvent():this._removeEvent()}}),Object.defineProperty(s,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,t?this.$content.css({border:"3px solid #37cb37",borderRadius:""}):this.$content.css({border:"0"})}}),s._animationEnd=function(){this.hide()},s._reset=function(){var e=this._messageData;if(e){var n=e.comment_content;n=JSON.parse(n),this.$content.html(n.content);var i=e.comment_uid_pointer,o=t.Const.defaultUserPic;if(i&&i.user_pic&&(o=i.user_pic),this.$photoContainer.html('<img src="'+o+'">'),null==n.x||null==n.y){var s=this._getStageSize(),a=t.getRandomPosition(s);n.x=a.x,n.y=a.y}this.$dom.css({left:n.x,top:n.y}),this._resetPos()}},s._resetPos=function(){var t=this.$dom.css("left"),e=this.$dom.width(),n=this._getStageSize();parseInt(t)+e>n.width?this.$dom.removeClass("comment-message-left").addClass("comment-message-right"):this.$dom.removeClass("comment-message-right").addClass("comment-message-left")},s.show=function(t,e){if(!this._isShow){this._isShow=!1,this._animateClass=e||"comment-msg-show",this.$dom.removeClass(this._animateClass),this.$dom.off("webkitAnimationEnd animationEnd");var n=this._messageData.comment_content;n=JSON.parse(n),this.$dom.addClass(this._animateClass),this.play(),this._barrageView&&this._barrageView.addMessage(this)}},s.tempShow=function(){this._isShow||(this._isShow=!1,this.isDragging=!0,this._barrageView.showTempMessage(this))},s.hide=function(){this.off("message:animation:end",this._animationEnd),this.$dom.removeClass("comment-msg-show"),this._removeEvent(),this.selected=!1,this._barrageView?(this._barrageView.removeMessage(this),this._barrageView=null,this._messageData=null,this.onHide()):this.$dom.remove()},s._addEvent=function(){var t=this;this.$dom.on("touchstart mousedown",function(e){t._downHandle(e)}),this.$dom.on("touchmove mousemove",function(e){t._moveHandle(e)}),this.$dom.on("touchend mouseup",function(e){t._upHandle(e)})},s._downHandle=function(t){this._isDown=!0;var e=this._mapPoint(t);this.offset.x=e.x-this.dom.offsetLeft,this.offset.y=e.y-this.dom.offsetTop},s._mapPoint=function(t){var e=0,o=0,s=t.originalEvent||t;if(s.constructor===i){var a=s.touches[0];e=a.pageX,o=a.pageY}else s.constructor===n&&(e=s.pageX,o=s.pageY);return{x:e,y:o}},s._moveHandle=function(t){if(t.preventDefault(),t.stopPropagation(),this._isDown){var e=this._mapPoint(t),n=e.x-this.offset.x,i=e.y-this.offset.y,o=(this.$dom.css("left"),this.$dom.css("top"),this.$content.width()),s=this.$dom.height(),a=this._barrageView.dom,m=a.clientWidth,r=a.clientHeight;0>n?(n=10,this.$dom.removeClass("comment-message-right").addClass("comment-message-left")):n+o+80>m&&(n=.4*m-10,this.$dom.removeClass("comment-message-left").addClass("comment-message-right")),0>i?i=10:i+s+50>r&&(i=r-s-50),this.$dom.css({left:n+"px",top:i+"px"})}},s._upHandle=function(t){this._isDown=!1},s.clear=function(){this.$photoContainer.html(""),this.hide(),this.$dom.removeClass(this._animateClass),this.$dom.off("webkitAnimationEnd animationEnd"),this._animateClass=null},s._removeEvent=function(){this.$dom.off("touchstart mousedown"),this.$dom.off("touchmove mousemove"),this.$dom.off("touchend mouseup")},s.onHide=function(){},t.MessageView=o}(cm),function(t){var e='<div class="comment-reply-txt"> <div class="comment-table-cell"><svg version="1.1" class="img" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="50px" height="50px" viewBox="0 0 1024 1024" enable-background="new 0 0 1024 1024" xml:space="preserve"><path fill="#f4c600" d="M511.999488 744.967304c-245.74903 0-444.967304-199.219297-444.967304-444.967304 0-245.748007 199.218274-444.967304 444.967304-444.967304 245.748007 0 444.967304 199.219297 444.967304 444.967304C956.966793 545.74903 757.747495 744.967304 511.999488 744.967304zM350.072539 533.502102c42.302455 0 76.596516-40.735773 76.596516-90.985224s-34.293037-90.985224-76.596516-90.985224c-42.303478 0-76.596516 40.735773-76.596516 90.985224S307.769061 533.502102 350.072539 533.502102zM509.523087 43.310803c-202.848964 4.956895-237.351779 171.880649-237.351779 171.880649 272.15033-223.125777 474.705606 0 474.705606 0C704.721815 43.273964 517.45678 43.273964 509.523087 43.310803zM674.365436 351.532677c-42.303478 0-76.597539 40.735773-76.597539 90.985224s34.294061 90.985224 76.597539 90.985224c42.302455 0 76.596516-40.735773 76.596516-90.985224S716.667891 351.532677 674.365436 351.532677z" transform="translate(0, 812) scale(1, -1)"></path></svg></div> <div class="comment-table-cell"><input class="comment-reply-input" type="text" placeholder="我要评论(限50字)" maxlength="50"/></div> <div class="comment-table-cell"><span class="comment-sent-btn cno-send-btn"></span></div></div>',n=function(n){
t.EventDispatcher.call(this),this.$dom=$("<div>"),this.$dom.addClass("comment-reply-container half-zoom"),this.$dom.html(e),this.maskLayer=$("<div>"),this.maskLayer.addClass("comment-mask-parent"),this.comment=n,this.commentDraft={},this.$sendButton=this.$dom.find(".comment-sent-btn"),this.$inputText=this.$dom.find(".comment-reply-input"),this._isShow=!1,this._replyTarget=null,this.dom=this.$dom[0]};t.inherit(n,t.EventDispatcher);var i=n.prototype;i.show=function(t){var e="";if(e=t?t.objectId:this.comment.pageTplId,!this._isShow){this._addEvent(),this._replyTarget=t,this._isShow=!0,document.body.appendChild(this.maskLayer[0]),document.body.appendChild(this.dom),this.$inputText.focus();var n=this.commentDraft[e],i=n?n:"";this.$inputText.val(i)}},i._addEvent=function(){var e=this;this.$sendButton.on("tap",function(t){t.preventDefault(),t.stopPropagation(),e._sendFn()}),this.maskLayer.on("tap",function(n){n.preventDefault(),n.stopPropagation(),e.hide();var i=t.createEvent("reply:error");e.comment.dispatchEvent(i)}),this.$inputText.on("input",function(){e._checkText()})},i._sendFn=function(){var e=this.$inputText.val();if(e=e.replace(/(^\s*)|(\s*$)/g,""),0!=e.length){e=e.replace(/(<)+|(>)+/g,function(t,e){return"<"==t?"&lt;":"&gt;"}),e.length>50&&(e=e.substring(0,50));var n=t.createEvent("create:reply",null);n.replyTarget=this._replyTarget,n.replyText=e,this.dispatchEvent(n),this.hide()}},i._checkText=function(){var t="",e=this.$inputText.val();e=e.replace(/ /g,""),0==e.length?this.$sendButton.removeClass("cyes-send-btn").addClass("cno-send-btn"):this.$sendButton.removeClass("cno-send-btn").addClass("cyes-send-btn"),t=this._replyTarget?this._replyTarget.objectId:this.comment.pageTplId,this.commentDraft[t]=e},i._removeEvent=function(){this.$sendButton.off("tap"),this.maskLayer.off("tap"),this.$inputText.off("change keyup paste cut")},i.hide=function(){if(this._isShow){var t=this;setTimeout(function(){t._isShow=!1},100),this._removeEvent(),this._replyTarget=null,this.$inputText.val("").blur(),document.body.removeChild(this.maskLayer[0]),document.body.removeChild(this.dom)}},t.ReplyView=n}(cm),function(t){var e='<div class="ocbalert-cancel">取 消</div><div class="ocbalert-ok">完 成</div>';t.OCBAlert=function(){this.$dom=$("<div>"),this.$dom.css({zIndex:9999}),this.$dom.html(e),this.$dom.addClass("comment-ocbalert half-zoom"),this.dom=this.$dom[0],this._isShow=!1,this.okButton=this.$dom.find(".ocbalert-ok")[0],this.cancelButton=this.$dom.find(".ocbalert-cancel")[0];var t=this;this.$dom.on("tap",function(e){t._clickFn(e)})};var n=t.OCBAlert.prototype;n.show=function(t,e){this._isShow||(this._isShow=!0,document.body.appendChild(this.dom),this._okFn=t,this._cancelFn=e)},n.hide=function(){this._isShow&&(document.body.removeChild(this.dom),this._isShow=!1,this._okFn=null,this._cancelFn=null)},n._clickFn=function(t){t.preventDefault(),t.stopPropagation();var e=t.target;e===this.okButton?this._okFn&&this._okFn():this._cancelFn&&this._cancelFn(),this.hide()};var i;t.OCBAlert.show=function(e,n){return i||(i=new t.OCBAlert),i.show(e,n),i},t.OCBAlert.hide=function(){return i?(i.hide(),i):void 0}}(cm);